
<div class="banner">
  <div class="container">
    <h1><strong>Vos Challenges!</strong></h1>



<div class="custom-container">

  <h2>Challenges in Progress</h2>
  <div class="row">
    <% sorted_user_challenges = @user_challenges.reject { |uc| uc.done }.sort_by { |uc| [uc.action.category.title, uc.action.name] } %>
    <% current_category = nil %>
    <% sorted_user_challenges.each do |user_challenge| %>
      <div class="col-6 cards-action-index">
        <div class="custom-card-custom-action-card">
          <div class="custom-card-title" style="background-color: <%= user_challenge.action.category.category_color %>">
            <%= link_to user_challenge_path(user_challenge), class:'link-to-text text-truncate' do %>
              <%= user_challenge.action.name %>
            <% end %>
          </div>
          <% unless user_challenge.done %>
            <div class="custom-card-icon">
              <%= link_to user_challenge_path(user_challenge) do %>
                <%= image_tag("icons/#{user_challenge.action.icon}", alt: 'Icon') %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

<h2>Completed Challenges</h2>
<div class="completed-challenges-list">
  <% completed_challenge_counts = Hash.new(0) %>
  <% completed_categories = Set.new %>
  <% @user_challenges.select { |uc| uc.done }.each do |completed_challenge| %>
    <% challenge_name = completed_challenge.action.name %>
    <% completed_challenge_counts[challenge_name] += 1 %>
    <% completed_categories.add(completed_challenge.action.category.title.downcase.gsub(' ', '_')) %>
  <% end %>

  <div class="custom-card" id="accordionPanelsStayOpenExample1">
    <% completed_categories.each do |category| %>
      <div class="accordion-item">
        <% category_display = category.gsub('_', ' ').titleize %> <!-- Convert back to display format -->
        <h2 class="accordion-header" id="panelsStayOpen-headingOne-<%= category %>">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne-<%= category %>" aria-expanded="false" aria-controls="panelsStayOpen-collapseOne-<%= category %>">
            <%= category_display %>
          </button>
        </h2>
        <div id="panelsStayOpen-collapseOne-<%= category %>" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingOne-<%= category %>" data-bs-parent="#accordionPanelsStayOpenExample1">
          <div class="accordion-body">
            <div class="card-body text-center d-flex justify-content-start">
              <ul>
                <% @user_challenges.select { |uc| uc.done && uc.action.category.title.downcase.gsub(' ', '_') == category }.each do |completed_challenge| %>
                  <% challenge_name = completed_challenge.action.name %>
                  <% if completed_challenge_counts[challenge_name] > 0 %>
                    <li><%= "#{challenge_name} (Completed #{completed_challenge_counts[challenge_name]} times)" %></li>
                    <% completed_challenge_counts[challenge_name] = 0 %>
                  <% end %>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>



<%# <h2>Completed Challenges</h2>
  <ul class="completed-challenges-list">
    <% current_category = nil %>
    <%# <% @user_challenges.select { |uc| uc.done }.each do |completed_challenge| %>
      <%# <% if completed_challenge.action.category.title != current_category %>
        <%# <% current_category = completed_challenge.action.category.title %>
        <%# <h3><%= current_category</h3> %>
      <%# <% end %>
      <%# <li><%= completed_challenge.action.name %><%#</li> %>
    <%# <% end %>
  <%# </ul> %>
<%# </div> %>

<%# <h2>Completed Challenges</h2> %>
  <%# <ul class="completed-challenges-list"> %>
    <%# <% completed_challenge_counts = Hash.new(0) %>
    <%# <% @user_challenges.select { |uc| uc.done }.each do |completed_challenge| %>
      <%# <% completed_challenge_counts[completed_challenge.action.name] += 1 %>
    <%# <% end %>
    <%# <% completed_challenge_counts.each do |challenge_name, count| %>
      <%# <li><%= "#{challenge_name} (Completed #{count} times)" %><%#</li> %>
    <%# <% end %>
  <%# </ul> %>
<%# </div> %>
